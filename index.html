<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <title>Gun Violence Tracker</title>
    <style>
      #map {
        width: 1000px;
        height: 500px;
      }
    </style>

    <!-- Bootstrap -->

    <link rel='stylesheet' href='/Styles/lib/normalize-3.0.2.css' type='text/css'/>
    <link rel='stylesheet' href='/vendor/styles/bootstrap/css/bootstrap.min.css' type='text/css'>

    <script src='https://code.jquery.com/jquery-1.11.3.min.js'></script>
    <script src='https://maps.googleapis.com/maps/api/js'></script>
    <script type='text/javascript'>
      function initMap() {
        var map;
        var coordinate = {lat:37.09024,lng:-95.712891}; //Coordinate for the USA
        var loadMarker = false;
        var mapOptions = {
          center: coordinate,
          zoom: 4,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        var dataURL = 'data/gunViolenceArchive.json';
        var markerJSON = {};
        $.ajax({url: dataURL, success: function() {
          console.log('Returning data from ' + dataURL);
        }, error: function() {
          console.log('Failed to load data from ' + dataURL);
        }}).done(function(data) {
          markerJSON = data;
          loadMarker = true;
        });
        map = new google.maps.Map(document.getElementById('map'),mapOptions);
        var markerCounter = 0;
        var geocoder = new google.maps.Geocoder();
        var loadMapMarkers = setInterval(function(){
          if (loadMarker) {
            loadMarker = false;
            var marker = markerJSON[markerCounter];
            var address = (marker["Address"] + ' ' + marker["City or County"] + ', ' + marker["State"]);
            geocoder.geocode({'address':address}, function(results,status) {
              if (status == google.maps.GeocoderStatus.OK) {
                var latitude = results[0].geometry.location.lat();
                var longitude = results[0].geometry.location.lng();
                coordinate.lat = latitude;
                coordinate.lng = longitude;
                var mapMarker = new google.maps.Marker({
                  position: coordinate,
                  map: map,
                  title: marker["Incident Date"]
                });
                markerCounter++;
                console.log(markerCounter);
                loadMarker = true;
                /*
                if (markerCounter === markerJSON.length) {
                  clearInterval(loadMapMarkers);
                }
                */
              }
            });
            /*
            //geocoder built from example found here: http://stackoverflow.com/questions/5984179/javascript-geocoding-from-address-to-latitude-and-longitude-numbers-not-working

            */
          }
        },1000);
      }
      google.maps.event.addDomListener(window, 'load', initMap);
    </script>
  </head>
  <body>
    <div id="map"></div>

    <h1>HELLO</h1>


    <script src='https://cdn.rawgit.com/visionmedia/page.js/master/page.js'></script>
    <script src='/vendor/webDB.js'></script>
    <script src='/vendor/styles/bootstrap/js/bootstrap.min.js'></script>
  </body>
</html>
